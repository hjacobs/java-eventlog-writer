Zomcat JPA
==========
Joerg Bellmann
v1.4.0-SNAPSHOT, 2013
:doctype: book
:toc:
:icons:
:numbered:


image::icon.png[link="http://10.111.151.89:10080/jenkins/job/ZOMCAT_JPA_MVN_3/badge/icon"]

Das Zomcat-JPA-Project beinhaltet einige Erweiterungen und Anpassungen um JPA bei Zalando zu verwenden.

.Diese Dokumenation
****
Diese Dokumentation ist Work-In-Progress und sollte im Laufe der Zeit aktualisiert werden. ;-)
****


zomcat-jpa-eclipselink
----------------------

Grundlegende Unterstützung für die Verwendugn von JPA bei Zalando. Ein Session-Customizer sorgt für die Zalando-Spezifische Benamung
von Tabellen und Spalten.

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.0"
    xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd">
    <persistence-unit name="default">
        <class>de.zalando.jpa.example.order.Address</class>
        <class>de.zalando.jpa.example.order.PurchaseOrderPosition</class>
        <class>de.zalando.jpa.example.order.PurchaseOrder</class>
        <exclude-unlisted-classes>false</exclude-unlisted-classes>
        <properties>
            <property name="eclipselink.persistence-context.flush-mode" value="COMMIT" />
            <property name="eclipselink.ddl-generation" value="create-or-extend-tables" />
            <property name="eclipselink.ddl-generation.output-mode" value="database"/>
            <property name="eclipselink.weaving" value="false" />
            <!-- Customizer for Zalando Tabellen- und Spalten-Namen -->
            <property name="eclipselink.session.customizer" value="de.zalando.jpa.eclipselink.DefaultZomcatSessionCustomizer"/>
            <!-- Use special EnumConverter to work with Progress -->
            <!-- <property name="eclipselink.session.customizer" value="de.zalando.jpa.eclipselink.PostgresZomcatSessionCustomizer"/>-->
            <!-- Custom SessionLog implementation to use SLF4J -->
            <property name="eclipselink.logging.logger" value="de.zalando.jpa.eclipselink.Slf4jSessionLog"/>
            <property name="eclipselink.logging.timestamp" value="false"/>
            <property name="eclipselink.logging.session" value="false"/>
            <property name="eclipselink.logging.connection" value="false"/>
            <property name="eclipselink.logging.thread" value="false"/>
            <property name="eclipselink.logging.level.transaction" value="ALL"/>
            <property name="eclipselink.logging.level.sql" value="FINE"/>
            <property name="eclipselink.logging.level.event" value="ALL"/>
            <property name="eclipselink.logging.level.connection" value="ALL"/>
            <property name="eclipselink.logging.level.query" value="FINE"/>
            <property name="eclipselink.logging.level.cache" value="ALL"/>
            <property name="eclipselink.logging.level" value="ALL"/>
            <property name="eclipselink.logging.parameters" value="true"/>
        </properties>
    </persistence-unit>
</persistence>
----




Chapters can contain sub-sections nested up to three deep.
footnote:[An example footnote.]
indexterm:[Example index entry]

Chapters can have their own bibliography, glossary and index.

And now for something completely different: ((monkeys)), lions and
tigers (Bengal and Siberian) using the alternative syntax index
entries.
(((Big cats,Lions)))
(((Big cats,Tigers,Bengal Tiger)))
(((Big cats,Tigers,Siberian Tiger)))
Note that multi-entry terms generate separate index entries.

Here are a couple of image examples: an image:images/smallnew.png[]
example inline image followed by an example block image:

.Tiger block image
image::images/tiger.png[Tiger image]

Followed by an example table:

.An example table
[width="60%",options="header"]
|==============================================
| Option          | Description
| -a 'USER GROUP' | Add 'USER' to 'GROUP'.
| -R 'GROUP'      | Disables access to 'GROUP'.
|==============================================

.An example example
===============================================
Lorum ipum...
===============================================

[[X1]]
Sub-section with Anchor
~~~~~~~~~~~~~~~~~~~~~~~
Sub-section at level 2.

Chapter Sub-section
^^^^^^^^^^^^^^^^^^^
Sub-section at level 3.

Chapter Sub-section
+++++++++++++++++++
Sub-section at level 4.

This is the maximum sub-section depth supported by the distributed
AsciiDoc configuration.
footnote:[A second example footnote.]



zomcat-jpa-domain
-----------------


.Deprecated
****
Dieses Modul ist als Deprecated markiert und sollte nicht mehr verwendet werden.
****

Es empfiehlt sich http://www.springsource.org/spring-data/jpa[Spring-Data-JPA] zu verwenden. Passt wunderbar in unsere Umgebung und wird von
http://www.springsource.org[SpringSource] maintained. Kein Aufwand bei uns.

spring-data-jpa-extensions
--------------------------

Eine Erweiterung für generierte BusinessKeys die genauso funktioniert wie Spring-Data Auditing.

[source,java]
----
    @BusinessKey("BusinessKeyProduct")
    private String businessKey;
----

Maven-Konfiguration:

[source,xml]
<dependency>
    <groupId>de.zalando</groupId>
    <artifactId>spring-data-jpa-extensions</artifactId>
    <version>1.4.0-SNAPSHOT</version>
</dependency>

Spring-Konfiguration:

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jpa="http://www.springframework.org/schema/data/jpa"
    xmlns:zjpa="http://www.zalando.de/schema/data/jpa" xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
    http://www.zalando.de/schema/data/jpa http://www.zalando.de/schema/data/jpa/spring-zjpa-1.0.xsd">

    <zjpa:businesskey businesskey-generator-ref="businessKeyGeneratorStub"/>

    <bean id="businessKeyGeneratorStub" class="de.zalando.data.jpa.domain.sample.BusinessKeyGeneratorStub"/>

    <jpa:repositories base-package="de.zalando.data.jpa.repository.sample"/>
</beans>
----

In der META-INF/orm.xml

[source,xml]
-----
<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_2_0.xsd"
    version="2.0">
    <persistence-unit-metadata>
        <persistence-unit-defaults>
            <entity-listeners>
                <entity-listener class="de.zalando.data.jpa.domain.support.BusinessKeyEntityListener"/>
            </entity-listeners>
        </persistence-unit-defaults>
    </persistence-unit-metadata>
</entity-mappings>
-----


spring-data-jpa-auditing-filter
-------------------------------

Unterstützt Spring-Data-JPA Auditing mit einem einfachen Filter-Mechanismus.

spring-data-jpa-auditing-cxf
----------------------------

Unterstützt Spring-Data-JPA Auditing mit Interceptoren für den Message-Flow.


The Second Chapter
------------------
An example link to anchor at start of the <<X1,first sub-section>>.
indexterm:[Second example index entry]

An example link to a bibliography entry <<taoup>>.


The Third Chapter
-----------------
Book chapters are at level 1 and can contain sub-sections.


:numbered!:

[appendix]
Example Appendix
----------------
One or more optional appendixes go here at section level 1.

Appendix Sub-section
~~~~~~~~~~~~~~~~~~~
Sub-section body.


[bibliography]
Example Bibliography
--------------------
The bibliography list is a style of AsciiDoc bulleted list.

[bibliography]
.Books
- [[[taoup]]] Eric Steven Raymond. 'The Art of Unix
  Programming'. Addison-Wesley. ISBN 0-13-142901-9.
- [[[walsh-muellner]]] Norman Walsh & Leonard Muellner.
  'DocBook - The Definitive Guide'. O'Reilly & Associates. 1999.
  ISBN 1-56592-580-7.

[bibliography]
.Articles
- [[[abc2003]]] Gall Anonim. 'An article', Whatever. 2003.


[glossary]
Example Glossary
----------------
Glossaries are optional. Glossaries entries are an example of a style
of AsciiDoc labeled lists.

[glossary]
A glossary term::
  The corresponding (indented) definition.

A second glossary term::
  The corresponding (indented) definition.


[colophon]
Example Colophon
----------------
Text at the end of a book describing facts about its production.


[index]
Example Index
-------------
////////////////////////////////////////////////////////////////
The index is normally left completely empty, it's contents being
generated automatically by the DocBook toolchain.
////////////////////////////////////////////////////////////////