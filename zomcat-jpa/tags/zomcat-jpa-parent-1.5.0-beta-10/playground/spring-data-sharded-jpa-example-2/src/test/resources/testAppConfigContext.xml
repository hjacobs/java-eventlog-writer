<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd">

    <bean id="configLRUCache" class="de.zalando.appconfig.cache.impl.LRUConfigurationCache">
        <constructor-arg index="0" value="1000" /> <!-- cacheSize -->
    </bean>

    <bean id="systemEnvironmentResource" class="de.zalando.appconfig.resources.SystemEnvironmentResource" />

    <bean id="shardedConfigurationService" class="de.zalando.catalog.persistence.configuration.ShardedConfigurationSProcServiceImpl" >
        <constructor-arg index="0" ref="appConfigDataSourceProvider"/>
    </bean>

    <bean id="configurationService" class="de.zalando.catalog.persistence.configuration.ShardedConfigurationService"  >
        <constructor-arg index="0" ref="shardedConfigurationService"/>
    </bean>

    <bean id="configurationManager" class="de.zalando.appconfig.resources.ConfigurationManager">
        <constructor-arg ref="configurationService" />
    </bean>

    <bean id="selfUpdateableDBResource" class="de.zalando.appconfig.resources.SelfUpdateableDBResource">
        <constructor-arg index="0" ref="configurationManager" />
        <constructor-arg index="1" value="60" />
        <constructor-arg index="2" value="60" />
        <constructor-arg index="3" type="java.util.concurrent.TimeUnit" value="SECONDS" />
        <constructor-arg index="4" ref="configLRUCache" />
    </bean>

    <bean id="applicationPropertiesFileResource" class="de.zalando.appconfig.resources.PropertyFileResource">
        <constructor-arg index="0" value="application.test.properties" /> <!-- properties file -->
    </bean>

    <bean id="compositeConfiguration" class="de.zalando.appconfig.impl.CompositeConfiguration">
        <property name="cachingPolicy" ref="configLRUCache" /> <!-- add caching -->
        <property name="resources"> <!-- list of resources -->
            <list>
                <ref bean="systemEnvironmentResource" />
                <ref bean="selfUpdateableDBResource" />
                <ref bean="applicationPropertiesFileResource" />
            </list>
        </property>
    </bean>

</beans>
